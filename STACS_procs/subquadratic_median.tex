\documentclass[a4paper,UKenglish,numberwithinsect,cleveref, autoref]{lipics-v2021}

%%%%%% PACKAGES %%%%%%
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
%\usepackage{graphicx}
\usepackage{tikz}
\usepackage{esvect}
\usepackage[ruled]{algorithm2e}
%\usepackage{caption}
\usepackage{subcaption}
\usepackage{amsthm}
\usepackage{mathtools}
%\usepackage[colorlinks = true, citecolor = {blue}]{hyperref}


\usetikzlibrary{arrows}

\DeclareMathOperator*{\argmax}{argmax}


%%%%%% THEOREMS %%%%%%
%\newtheorem{theorem}{Theorem}
%\newtheorem{definition}{Definition}
%\newtheorem{lemma}{Lemma}
%\newtheorem{example}{Example}
%\newtheorem{corollary}{Corollary}
%\newtheorem{problem}{Problem}
%\newtheorem{acknowledgement}[theorem]{Acknowledgement}
%\newtheorem{axiom}[theorem]{Axiom}
%\newtheorem{case}[theorem]{Case}
%\newtheorem{claim}{Claim}
%\newtheorem{conclusion}[theorem]{Conclusion}
%\newtheorem{condition}[theorem]{Condition}
%\newtheorem{conjecture}[theorem]{Conjecture}

%\newtheorem*{mainresult}{Main result}

%\newenvironment{proof}[1][Proof]{\textbf{#1.} }{\ \rule{0.5em}{0.5em}}




%%%%%%% COMMANDS %%%%%%
\newcommand{\set}[1]{\left\{ #1 \right\}}
\newcommand{\card}[1]{\left| #1 \right|}
\newcommand{\ith}[1]{#1^{\mbox{\scriptsize{th}}}}

% algo
\newcommand{\checkperp}{\mbox{\textsf{check}}^{\perp}}
\newcommand{\ifend}{\textbf{endif}}

%diam - radius - ecc
\newcommand{\diam}{\mbox{\textsf{diam}}}
\newcommand{\rad}{\mbox{\textsf{rad}}}
\newcommand{\ecc}{\mbox{\textsf{ecc}}}
\newcommand{\opp}{\mbox{\textsf{op}}}
\newcommand{\rc}{\mbox{RC}}

%Hasse diagrams
\newcommand{\hul}{H_u^{\mbox{\scriptsize{L}}}}
\newcommand{\hual}{H_u^{\mbox{\scriptsize{AL}}}}
\newcommand{\varphis}{\varphi_{\subseteq}}
\newcommand{\psis}{\psi_{\supseteq}}

%Cliques max
\newcommand{\mcalc}{\mathcal{C}}
\newcommand{\mcalcm}{\mathcal{C}_{\mbox{\scriptsize{max}}}}
\newcommand{\trp}{\mbox{Trp}}
\newcommand{\huv}{H_{u \rightarrow v}}
\newcommand{\hvu}{H_{v \rightarrow u}}


\bibliographystyle{plainurl}

\title{Subquadratic-time algorithm for the diameter and all eccentricities on median graphs}

\titlerunning{All eccentricities on median graphs in subquadratic time} %TODO optional, please use if title is longer than one line


\author{Pierre Berg\'e\footnote{Corresponding author}}{Univ Lyon, CNRS, ENS de Lyon, Universit\'e Claude Bernard Lyon 1, LIP, France \and IRIF, CNRS, Universit\'e de Paris, France}{}{}{}

\author{Guillaume {Ducoffe}}{National Institute for Research and Development in Informatics, Romania \and University of Bucharest, Romania}{}{}{}

\author{Michel {Habib}}{IRIF, CNRS, Universit\'e de Paris, France}{}{}{}

\authorrunning{P. Berg\'e, G. Ducoffe, and M. Habib} %TODO mandatory. First: Use abbreviated first/middle names. Second (only in severe cases): Use first author plus 'et al.'

\Copyright{Pierre Berg\'e, Guillaume Ducoffe, and Michel Habib} %TODO mandatory, please use full first names. LIPIcs license is "CC-BY";  http://creativecommons.org/licenses/by/3.0/

\ccsdesc{Theory of computation~Parameterized complexity and exact algorithms}

\ccsdesc{Theory of computation~Data structures design and analysis}

\keywords{Diameter, Eccentricities, Metric graph theory, Median graphs, Hypercubes.} %TODO mandatory; please add comma-separated list of keywords


\EventEditors{Petra Berenbrink and Benjamin Monmege}
\EventNoEds{2}
\EventLongTitle{39th International Symposium on Theoretical Aspects of Computer Science (STACS 2022)}
\EventShortTitle{STACS 2022}
\EventAcronym{STACS}
\EventYear{2022}
\EventDate{March 15--18, 2022}
\EventLocation{Marseille, France}
\EventLogo{}
\SeriesVolume{219}
\ArticleNo{38}

\begin{document}

\maketitle

\begin{abstract}
On sparse graphs, Roditty and Williams [2013] proved that no $O(n^{2-\varepsilon})$-time algorithm achieves an approximation factor smaller than $\frac{3}{2}$ for the diameter problem unless SETH fails.
In this article, we answer an open question formulated in the literature: can we use the structural properties of median graphs to break this global quadratic barrier?

We propose the first combinatorial algorithm computing exactly all eccentricities of a median graph in truly subquadratic time. Median graphs constitute the family of graphs which is the most studied in metric graph theory because their structure represents many other discrete and geometric concepts, such as CAT(0) cube complexes. Our result generalizes a recent one, stating that there is a linear-time algorithm for computing all eccentricities in median graphs with bounded dimension $d$, {\em i.e.} the dimension of the largest induced hypercube (note that 1-dimensional median graphs are exactly the forests). This prerequisite on $d$ is not necessarily anymore to determine all eccentricities in subquadratic time. The execution time of our algorithm is $O(n^{1.6456}\log^{O(1)} n)$.

We provide also some satellite outcomes related to this general result. In particular, restricted to simplex graphs, this algorithm enumerates all eccentricities with a quasilinear running time. Moreover, an algorithm is proposed to compute exactly all reach centralities in time $O(2^{3d}n\log^{O(1)}n)$.
\end{abstract}

\newpage

\section{Introduction} \label{sec:intro}

Median graphs can be certainly identified as the most important family of graphs in metric graph theory. They are related to numerous areas: universal algebra~\cite{Av61,BiKi47}, CAT(0) cube complexes~\cite{BaCh08,Ch00}, abstract models of concurrency~\cite{BaCo93,SaNiWi93}, and genetics~\cite{BaQuSaMa02,BaFoSyRi95}. Let $d(a,b)$ be the length ({\em i.e.} the number of edges) of the shortest $(a,b)$-path for $a,b \in V$ and $I(a,b)$ be the set made up of all vertices $u$ metrically between $a$ and $b$, {\em i.e.} $d(a,b) = d(a,u) + d(u,b)$. Median graphs are the graphs such that for any triplet of distinct vertices $x,y,z \in V$, set $I(x,y) \cap I(y,z) \cap I(z,x)$ is a singleton, containing the \textit{median} $m(x,y,z)$ of this triplet.

The purpose of this article is to break the quadratic barrier for the computation time of certain metric parameters on median graphs. In particular, we focus on one of the most fundamental problems in algorithmic graph theory related to distances: the \textit{diameter}. Given an undirected graph $G=(V,E)$, the diameter is the maximum distance $d(u,v)$ for all $u,v \in V$. Two vertices at maximum distance form a \textit{diametral pair}. An even more general problem consists in determining all eccentricities of the graph. The eccentricity $\ecc(v)$ of a vertex $v$ is the maximum length of a shortest path starting from $v$: $\ecc(v) = \max_{w \in V} d(v,w)$. The diameter is thus the maximum eccentricity.

\subsection{State of the art}

Executing a \textit{Breadth First Search} (BFS) from each vertex of an input graph $G$ suffices to obtain its eccentricities in $O(n\card{E})$, with $n = \card{V}$. As median graphs are relatively sparse, $\card{E} \le n\log n$, these multiple BFSs compute all eccentricities in time $O(n^2\log n)$ for this class of graphs.
Very efficient algorithms determining the diameter already exist on other classes of graphs, for example~\cite{AbWiWa16,Ca17,DuHaVi20}. Many works have also been devoted to approximation algorithms for this parameter. Chechik {\em et al.}~\cite{ChLaRoScTaWi14} showed that the diameter can be approximated within a factor $\frac{3}{2}$ in time $\tilde{O}(m^{\frac{3}{2}})$ on general graphs. On sparse graphs, it was shown in~\cite{RoWi13} that no $O(n^{2-\varepsilon})$-time algorithm achieves an approximation factor smaller than $\frac{3}{2}$ for the diameter unless the Strong Exponential Time Hypothesis (SETH) fails.

Median graphs are bipartite and can be isometrically embedded into hypercubes. They are the 1-skeletons of CAT(0) cube complexes~\cite{Ch00} and the domains of event structures~\cite{BaCo93}. They admit structural properties, such as the Mulder's convex expansion~\cite{Mu78,Mu80}. They are strongly related to hypercubes retracts~\cite{Ba84}, Cartesian products and gated amalgams~\cite{BaCh08}, but also Helly hypergraphs~\cite{MuSc79}. They do not contain induced $K_{2,3}$, otherwise a triplet of vertices would admit at least two medians. The \textit{dimension} $d$ of a median graph $G$ is the dimension of its largest induced hypercube. The value of this parameter is at most $\lfloor \log n \rfloor$ and meets this upper bound when $G$ is an hypercube. Moreover, parameter $d$ takes part in the sparsity of median graphs: $\card{E} \le dn$.

An important concept related to median graphs is the equivalence relation $\Theta$. This is the reflexive and transitive closure of relation $\Theta_0$, where two edges are in $\Theta_0$ if they are opposite in a common 4-cycle. A $\Theta$-\textit{class} is an equivalence class of $\Theta$. Each $\Theta$-class of a median graph forms a matching cutset, splitting the graph into two convex connected components, called \textit{halfspaces}. The number $q \le n$ of $\Theta$-classes corresponds to the dimension of the hypercube in which the median graph $G$ isometrically embeds.  Value $q$ satisfies the Euler-type formula $2n-m-q\le 2$~\cite{KlMuSk98}. A recent LexBFS-based algorithm~\cite{BeChChVa20} identifies the $\Theta$-classes in linear time $O(\card{E})=O(dn)$.

%Two subquadratic-time algorithms have been proposed for the recognition of median graphs. Using convex characterizations of halfspaces, Hagauer {\em et al.}~\cite{HaImKl99} showed that median graphs can be recognized in $O(n^{\frac{3}{2}}\log{n})$. In~\cite{ImKlMu99}, a bijection between median and triangle-free graphs makes the recognition algorithms for triangle-free graphs work on median ones~\cite{AlYuZw97}. Hence, median graphs can be recognized in $O((n\log^2 n)^{1.41})$ using this reduction.

There exist efficient algorithms for some metric parameters on median graphs. For example, the median set and the Wiener index can be determined in $O(\card{E})$~\cite{BeChChVa20}. 
Subfamilies of median graphs have also been studied. There is an algorithm computing the diameter and the radius in linear time for squaregraphs~\cite{ChDrVa02}. A more recent contribution introduces a quasilinear time algorithm - running in $O(n\log^{O(1)} n)$ - for the diameter on cube-free median graphs~\cite{Du20}, using distance and routing labeling schemes proposed in~\cite{ChLaRa19}. Eventually, a linear-time algorithm~\cite{BeHa21} for the diameter on constant-dimension median graphs was proposed, {\em i.e.} for median graphs satisfying $d=O(1)$.

The existence of a truly subquadratic-time algorithm for the diameter on all median graphs is open and was recently formulated in~\cite{BeChChVa20,BeHa21,Du20}. An even more ambitious question can be asked. Can this subquadratic barrier be overpassed for the problem of finding all eccentricities of a median graph ? As the total size of the output is linear and this problem generalizes the diameter one, this question is legitimate. More generally, the question holds for all metric parameters (except the median set and the Wiener index for which a linear-time algorithm was recently designed). In this article, we propose the first subquadratic-time algorithm computing all eccentricities on median graphs. 

\subsection{Contributions}

Our first contribution in this paper is the design of a quasilinear, {\em i.e.} $O((\log n)^{O(1)}n)$, time algorithm computing the diameter of simplex graphs. A simplex graph $K(G) = (V_K,E_K)$ of a graph $G$ is obtained by considering the induced complete graphs (cliques) of $G$ as vertices $V_K$. Then, two of these cliques are connected by an edge if they differ by only one element: one is $C$, the other is $C \cup \set{v}$. These edges form the set $E_K$. All simplex graphs are median~\cite{BaCh08,BaLeMo86}. Moreover, we observe that simplex graphs fulfil an interesting property: they admit a central vertex - representing the empty clique - and every $\Theta$-class has an edge incident to that vertex.

%We describe the algorithm in a few words. We observed that the eccentricities of each vertex of a simplex graph could be written as functions of the size of certain sets of pairwise orthogonal $\Theta$-classes (POFs). Based on that property, we order the POFs in function of their size and execute partition refinements. This reveals us a DAG structure of the POFs from which the eccentricity of each vertex can be extracted. 

First, this algorithm extends the set of median graphs for which a quasilinear time procedure computing the diameter exists. Indeed, simplex graphs form a sub-class of median graphs containing instances with unbounded dimension $d$.

\begin{itemize}
    \item There is a combinatorial algorithm determining the diameter and all eccentricities of simplex graphs in $O((d^3+\log n)n)$: Theorem~\ref{th:linear_simplex_teaser}, Section~\ref{sec:simplex}.
\end{itemize}

Second, we remark that this method can be integrated to the algorithm already proposed in~\cite{BeHa21} to compute all eccentricities of median graphs in time $O(2^{O(d\log d)}n)$. This allows us to decrease this running time. Thanks to this modification, the new algorithm proposed computes all eccentricities of a median graph in $\tilde{O}(2^{2d}n)$, where notation $\tilde{O}$ neglects poly-logarithmic factors. Even if the algorithm stays linear for constant-dimension median graphs, observe that the dependence on $d$ decreases, from a slightly super-exponential function to a simple exponential one.

\begin{itemize}
\item There is a combinatorial algorithm determining all eccentricities of median graphs in $\tilde{O}(2^{2d}n)$: Theorem~\ref{th:simple_ecc}, Section~\ref{subsec:constant_dim}.
\end{itemize}

The second and main contribution in this paper is the design of a subquadratic-time dynamic programming procedure which computes all eccentricities of any median graph. Here, the linear-time simple-exponential-FPT algorithm for all eccentricities presented above plays a crucial role: it is the base case. This framework consists in partitioning recursively the input graph $G$ into the halfspaces of its largest $\Theta$-class. With our construction, the leaves of this recursive tree are median graphs with dimension at most $\frac{1}{3}\log n$ and we can apply the former linear-time FPT algorithm.

\begin{itemize}
    \item There is a combinatorial algorithm determining all eccentricities of median graphs in $\tilde{O}(n^{\frac{5}{3}})$: Theorem~\ref{thm:guigui-5}, Section~\ref{subsec:reduction}.
\end{itemize}

We terminate by mentioning a possible improvement of this algorithm. Based on a faster enumeration of sets of pairwise orthogonal $\Theta$-classes, its running time can be decreased to $\tilde{O}(n^{\beta})$, where $\beta = 1.6456$. Due to page limit, this extra part is omitted.

All these outcomes put in evidence a relationship between the design of linear-time FPT algorithms and the design of subquadratic-time algorithms determining metric parameters on median graphs. We hope that the ideas proposed to establish all these results represent interesting tools to break the quadratic barrier on other open questions.

\subsection{Organization}

In Section~\ref{sec:median}, we remind the definition of median graphs. The well-known properties and concepts related to them are listed, among them $\Theta$-classes, signature, and POFs. Section~\ref{sec:simplex} summarizes our contribution on simplex graphs. In Section~\ref{sec:subquadratic}, we show how to obtain a linear-time simple-exponential-FPT algorithm for all eccentricities of a median graph, parameterized by the dimension $d$. Thanks to it, we propose a dynamic programming procedure to reduce the computation of eccentricities of any median graph to the same problem on a collection of median subgraphs of sub-logarithmic dimension. Eventually, we give in Section~\ref{sec:conclusion} some directions of research which could follow the contributions of this article. 

\section{Median graphs} \label{sec:median}

In this section, we recall some notions related to distances in graphs, and more particularly median graphs. Two important tools are presented: the $\Theta$-classes, which are equivalences classes over the edge set, and the \textit{Pairwise Orthogonal Families} (POFs) characterizing $\Theta$-classes belonging to a common hypercube. 

\subsection{$\Theta$-classes} 

All graphs $G = (V,E)$ considered in this paper are undirected, unweighted, simple, finite and connected. We denote by $N(u)$ the \textit{open neighborhood} of $u \in V$, {\em i.e.} the set of vertices adjacent to $u$ in $G$. We extend it naturally: for any set $A \subseteq V$, the neighborhood $N(A)$ of $A$ is the set of vertices outside $A$ adjacent to some $u \in A$.

Given two vertices $u,v \in V$, let $d(u,v)$ be the \textit{distance} between $u$ and $v$, {\em i.e.} the length of the shortest $(u,v)$-path. The \textit{eccentricity} $\ecc(u)$ of a vertex $u \in V$ is the length of the longest shortest path starting from $u$. Put formally, $\ecc(u)$ is the maximum value $d(u,v)$ for all $v \in V$: $\ecc(u) = \max_{v \in V} d(u,v)$. The diameter of graph $G$ is the maximum distance between two of its vertices: $\diam(G) = \max_{u \in V} \ecc(u)$. 

We denote by $I(u,v)$ the \textit{interval} of pair $u,v$. It contains exactly the vertices which lie metrically between $u$ and $v$:
$I(u,v) = \set{x \in V: d(u,x) + d(x,v) = d(u,v)}$. The vertices of $I(u,v)$ are lying on at least one shortest $(u,v)$-path.

We say that a set $H\subseteq V$ (or the induced subgraph $G\left[H\right]$) is \textit{convex} if $I(u,v) \subseteq H$ for any pair $u,v \in H$. Moreover, we say that $H$ is \textit{gated} if any vertex $v \notin H$ admits a \textit{gate} $g_H(v) \in H$, {\em i.e.} a vertex that belongs to all intervals $I(v,x)$, $x\in H$. For any $x \in H$, we have $d(v,g_H(v)) + d(g_H(v),x) = d(v,x)$. Gated sets are convex by definition.
%fiber
%If $H$ is gated, the \textit{fiber} $F_H(x)$ is the set of vertices which admit $x \in H$ as a gate for $H$. As each vertex in $H$ is its own gate, the fibers $F_H(x)$, $x \in H$ form a partition of $V$.

Given an integer $k \ge 1$, the hypercube of dimension $k$, $Q_k$, is a graph representing all the subsets of $\set{1,\ldots,k}$ as the vertex set. An edge connects two subsets if one is included into the other and they differ by only one element. Hypercube $Q_2$ is a \textit{square} and $Q_3$ is a $3$-cube.

\begin{definition}[Median graph]
A graph is \textit{median} if, for any triplet $x,y,z$ of distinct vertices, the set $I(x,y) \cap I(y,z) \cap I(z,x)$ contains exactly one vertex $m(x,y,z)$ called the \emph{median} of $x,y,z$.
\label{def:median}
\end{definition}

Observe that certain well-known families of graphs are median: trees, grids, squaregraphs~\cite{BaChEp10}, and hypercubes $Q_k$.
Median graphs are bipartite and do not contain an induced $K_{2,3}$~\cite{BaCh08,HaImKl11,Mu78}. They can be obtained by Mulder's convex expansion~\cite{Mu78,Mu80} starting from a single vertex.

\begin{figure}[h]

\begin{subfigure}[b]{0.32\columnwidth}
\centering
\scalebox{0.6}{\input{tikz/median_d1}}
\caption{Tree, $d=1$}
\end{subfigure}
\begin{subfigure}[b]{0.32\columnwidth}
\centering
\scalebox{0.6}{\input{tikz/median_d2}}
\caption{Squaregraph, $d=2$}
\end{subfigure}
\begin{subfigure}[b]{0.32\columnwidth}
\centering
\scalebox{0.6}{\input{tikz/median_d3}}
\caption{4-cube, $d=4$}
\end{subfigure}

\caption{Examples of median graphs}
\label{fig:median_examples}
\end{figure}

Now, we define a parameter which has a strong influence on the study of median graphs.
The dimension $d = \mbox{dim}(G)$ of a median graph $G$ is the dimension of the largest hypercube contained in $G$ as an induced subgraph.
In other words, $G$ admits $Q_d$ as an induced subgraph, but not $Q_{d+1}$. Median graphs with $d=1$ are exactly the trees. Median graphs with $d\le 2$ are called \textit{cube-free} median graphs.

Figure~\ref{fig:median_examples} presents three examples of median graphs. (a) is a tree: $d=1$. (b) is a cube-free median graph: it has dimension $d=2$. To be more precise, it is a squaregraph~\cite{BaChEp10}, which is a sub-family of cube-free median graphs. The last one (c) is a 4-cube: it has dimension $d=4$. 

We provide a list of properties satisfied by median graphs. In particular, we define the notion of $\Theta$-classes which is a key ingredient of several existing algorithms~\cite{BeChChVa20,HaImKl99,ImKlMu99}.

In general graphs, all gated subgraphs are convex. The reverse is true in median graphs.
\begin{lemma}[Convex$\Leftrightarrow$Gated~\cite{BaCh08,BeChChVa20}]
Any convex subgraph of a median graph is gated.
\end{lemma}

To improve readibility, edges $(u,v) \in E$ are sometimes denoted by $uv$. We remind the notion of $\Theta$-class, which is well explained in~\cite{BeChChVa20}, and enumerate some properties related to it. We say that the edges $uv$ and $xy$ are in relation $\Theta_0$ if they form a square $uvyx$, where $uv$ and $xy$ are opposite edges. Then, $\Theta$ refers to the reflexive and transitive closure of relation $\Theta_0$. Let $q$ be the number of equivalence classes obtained with this relation. The classes of the equivalence relation $\Theta$ are denoted by $E_1,\ldots,E_q$. Concretely, two edges $uv$ and $u'v'$ belong to the same $\Theta$-class if there is a sequence $uv = u_0v_0, u_1v_1, \ldots, u_rv_r= u'v'$ such that $u_iv_i$ and $u_{i+1}v_{i+1}$ are opposite edges of a square. We denote by $\mathcal{E}$ the set of $\Theta$-classes: $\mathcal{E} = \set{E_1,\ldots,E_q}$. To avoid confusions, let us highlight that parameter $q$ is different from the dimension $d$: for example, on trees, $d=1$ whereas $q = n-1$. Moreover, the dimension $d$ is at most $\lfloor \log n \rfloor$ in general.

\begin{lemma}[$\Theta$-classes in linear time~\cite{BeChChVa20}]
There exists an algorithm which computes the $\Theta$-classes $E_1,\ldots,E_q$ of a median graph in linear time $O(\card{E}) = O(dn)$.
\label{le:linear_classes}
\end{lemma}

In median graphs, each class $E_i$, $1\le i\le q$, is a perfect matching cutset and its two sides $H_i'$ and $H_i''$ verify nice properties, that are presented below.

\begin{lemma}[Halfspaces of $E_i$~\cite{BeChChVa20,HaImKl99,Mu80}]
For any $1\le i\le q$, the graph $G$ deprived of edges of $E_i$, {\em i.e.} $G\backslash E_i = (V,E\backslash E_i)$, has two connected components $H_i'$ and $H_i''$, called \textit{halfspaces}. Edges of $E_i$ form a matching: they have no endpoint in common. Halfspaces satisfy the following properties.
\begin{itemize}
\item Both $H_i'$ and $H_i''$ are convex/gated.
\item If $uv$ is an edge of $E_i$ with $u \in H_i'$ and $v \in H_i''$, then $H_i' = W(u,v) = \set{x \in V: d(x,u) < d(x,v)}$ and $H_i'' = W(v,u) = \set{x \in V: d(x,v) < d(x,u)}$.
\end{itemize}
\label{le:halfspaces}
\end{lemma}

\begin{figure}[h]
\centering
\scalebox{0.7}{\input{tikz/halfspaces}}
\caption{A class $E_i$ with sets $H_i', H_i'', \partial H_i', \partial H_i''$.}
\label{fig:halfspaces}
\end{figure}

We denote by $\partial H_i'$ the subset of $H_i'$ containing the vertices which are adjacent to a vertex in $H_i''$: $\partial H_i' = N(H_i'')$ Put differently, set $\partial H_i'$ is made up of vertices of $H_i'$ which are endpoints of edges in $E_i$. Symmetrically, set $\partial H_i''$ contains the vertices of $H_i''$ which are adjacent to $H_i'$. We say these sets are the \textit{boundaries} of halfspaces $H_i'$ and $H_i''$ respectively. Figure~\ref{fig:halfspaces} illustrates the notions of $\Theta$-class, halfspace and boundary on a small example. In this particular case, an halfspace is equal to its boundary: $\partial H_i'' = H_i''$. The vertices of $\partial H_i'$ are colored in blue.

\begin{lemma}[Boundaries~\cite{BeChChVa20,HaImKl99,Mu80}]
Both $\partial H_i'$ and $\partial H_i''$ are convex/gated. Moreover, the edges of $E_i$ define an isomorphism between $\partial H_i'$ and $\partial H_i''$.
\label{le:boundaries}
\end{lemma}


As a consequence, suppose $uv$ and $u'v'$ belong to $E_i$: if $uu'$ is an edge and belongs to class $E_j$, then $vv'$ is an edge too and it belongs to $E_j$. We terminate this list of lemmas with a last property dealing with the orientation of edges  from a canonical basepoint $v_0 \in V$. The \textit{$v_0$-orientation} of the edges of $G$ according to $v_0$ is such that, for any edge $uv$, the orientation is $\vv{uv}$ if $d(v_0,u) < d(v_0,v)$. Indeed, we cannot have $d(v_0,u) = d(v_0,v)$ as $G$ is bipartite. The $v_0$-orientation is acyclic.

\begin{lemma}[Orientation~\cite{BeChChVa20}]
All edges can be oriented according to any canonical basepoint $v_0$.
\end{lemma}

From now on, we suppose that an arbitrary basepoint $v_0 \in V$ has been selected and we refer automatically to the $v_0$-orientation when we mention incoming or outgoing edges.

\subsection{Shortest paths and signature}

We fix an arbitrary canonical basepoint $v_0$ and for each class $E_i$, we say that the halfspace containing $v_0$ is $H_i'$.
Given two vertices $u,v \in V$, we define the set which contains the $\Theta$-classes separating $u$ from $v$.

\begin{definition}[Signature $\sigma_{u,v}$]
We say that the {\em signature} of the pair of vertices $u,v$, denoted by $\sigma_{u,v}$, is the set of classes $E_i$ such that $u$ and $v$ are separated in $G\backslash E_i$. In other words, $u$ and $v$ are in different halfspaces of $E_i$.
\label{def:signature}
\end{definition}

The signature of two vertices provide us with the composition of any shortest $(u,v)$-path. Indeed, all shortest $(u,v)$-paths contain exactly one edge for each class in $\sigma_{u,v}$.

\begin{lemma}[\cite{BeHa21}]
For any shortest $(u,v)$-path $P$, the edges in $P$ belong to classes in $\sigma_{u,v}$ and, for any $E_i \in \sigma_{u,v}$, there is exactly one edge of $E_i$ in path $P$. Conversely, a path containing at most one edge of each $\Theta$-class is a shortest path between its departure and its arrival.
\label{le:signature}
\end{lemma}

This result is a direct consequence of the convexity of halfspaces. By contradiction, a shortest path that would pass through two edges of some $\Theta$-class $E_i$ would escape temporarily from an halfspace, say w.l.o.g $H_i'$,  which is convex (Lemma~\ref{le:halfspaces}).

Definition~\ref{def:signature} can be generalized: given a set of edges $B\subseteq E$, its signature is the set of $\Theta$-classes represented in that set: $\set{E_i : uv \in E_i \cap B}$. The signature of a path is the set of classes which have at least one edge in this path. In this way, the signature $\sigma_{u,v}$ is also the signature of any shortest $(u,v)$-path. The signature of a hypercube is the set of $\Theta$-classes represented in its edges: the cardinality of the signature is thus equal to the dimension of the hypercube.

\subsection{Orthogonal $\Theta$-classes and hypercubes}

We present now another important notion on median graphs: \textit{orthogonality}.

\begin{definition}[Orthogonal $\Theta$-classes]
We say that classes $E_i$ and $E_j$ are {\em orthogonal} ($E_i \perp E_j$) if there is a square $uvyx$ in $G$, where $uv,xy \in E_i$ and $ux,vy \in E_j$.
\end{definition}

We say that $E_i$ and $E_j$ are \textit{parallel} if they are not orthogonal, that is $H_i \subseteq H_j$ for some $H_i \in \set{H_i',H_i''}$, $H_j \in \set{H_j',H_j''}$. 
We define the sets of pairwise orthogonal $\Theta$-classes.

\begin{definition}[Pairwise Orthogonal Family]
We say that a set of classes $X \subseteq \mathcal{E}$ is a {\em Pairwise Orthogonal Family (POF for short)} if for any pair $E_j,E_h \in X$, we have $E_j \perp E_h$.
\end{definition}

For any induced hypercube of $G$, its \textit{basis} (resp. \textit{anti-basis}) is the closest vertex (resp. farthest) to $v_0$ in it. All edges of the hypercube indicent to the basis are outgoing from it. Hypercubes are in bijection with pairs $(u,L)$, where $u$ is a vertex (the basis of the hypercube) and $L$ is a POF outgoing from $u$ (the \textit{signature} of the hypercube).

The full version of this subsection is put in Appendix~\ref{asubsec:orthogonal}.

\subsection{Maximal POFs} \label{subsec:max_pofs}

We terminate this preliminary section with a few words on maximal POFs, {\em i.e.} POFs $X$ such that there is no other POF $Y \supsetneq X$. We highlight a natural bijection between maximal POFs and maximal hypercubes. Its proof is put in Appendix~\ref{asubsec:max_pofs}.

\begin{theorem}[\ref{th:maximal_pofs}]
For any maximal induced hypercube, the $\Theta$-classes of its edges form a maximal POF.
Conversely, for any maximal POF $X$, there exists an unique hypercube of signature $X$. 
\label{th:maximal_pofs_teaser}
\end{theorem}

%%%%%%%%%

\section{Simplex graphs} \label{sec:simplex}

Due to page limit, the proofs in this Section are omitted.
Given any undirected graph $G$, the vertices of the simplex graph $K(G)$ associated to $G$ represent the induced cliques (not necessarily maximal) of $G$. Two of these cliques are connected by an edge if they differ by exactly one element.

\begin{definition}[Simplex graphs~\cite{BaVe89}]
The simplex graph $K(G)=(V_K,E_K)$ of $G=(V,E)$ is made up of the vertex set $V_K = \set{C\subseteq V: C ~\emph{induced complete graph of}~ G}$ and the edge set $E_K = $\\ $\set{(C,C') : C,C' \in V_K, C \subsetneq C', \card{C'}-\card{C} = 1}$.
\label{def:simplex}
\end{definition}

Simplex graphs can be characterized as particular median graphs.

\begin{theorem}
Let $G$ be a median graph. The following statements are equivalent:
\begin{description}
    \item[(1)] $G$ is a simplex graph.
    \item[(2)] There is a vertex $v_0 \in V(G)$ such that each $\Theta$-class of $G$ is adjacent to $v_0$, {\em i.e.} $\forall 1\le i\le q, \exists v_i\in V(G), v_0v_i \in E_i$.
    \item[(3)] There is a vertex $v_0 \in V(G)$ contained in any maximal hypercube of $G$.
\end{description}
\label{th:simplex}
\end{theorem}

There is a combinatorial algorithm running in quasilinear time which, given a simplex graphs and positive integer weights $\omega_v$ associated with each vertex $v$, returns a list of \textit{opposites} $\opp(v)$, where $\opp(v)$ is the maximum-weighted vertex such that $v_0 \in I(v,\opp(v))$. Applying it for the case $\omega_v = \card{\mathcal{E}^-(v)}$ allows us to
compute the diameter and all eccentricities of simplex graphs in quasilinear time.
%Properties of simplex graphs, the design of this algorithm and its analysis are put in Appendix~\ref{asec:simplex}. 

\begin{theorem}
There is a combinatorial algorithm determining all eccentricities of a simplex graph in time $O((d^3+\log n)n)$.
\label{th:linear_simplex_teaser}
\end{theorem}

\section{Subquadratic-time algorithm for all eccentricities on median graphs} \label{sec:subquadratic}

This section introduces the design of algorithms computing all eccentricities for the whole class of  median graphs (not only simplex graphs). We begin in Section~\ref{subsec:constant_dim} with the proposal of a linear-time FPT algorithm, parameterized by the dimension $d$, running in $2^{O(d)}n$. It is based on some techniques of a paper of the literature~\cite{BeHa21} which provides a slightly super-exponential time algorithm - running in $2^{O(d\log d)}n$ - for the same problem. We prove that replacing one step of this procedure by the partitioning conceived in Section~\ref{sec:simplex} allows us to decrease the exponential dependence on $d$.

 Thanks to this outcome, in Section~\ref{subsec:reduction}, we are able to design a first subquadratic-time algorithm for all median graphs running in $\tilde{O}(n^{\frac{5}{3}})$.

\subsection{Linear FPT algorithm for constant-dimension median graphs} \label{subsec:constant_dim}

We remind in this subsection the different steps needed to obtain a linear-time algorithm computing all eccentricities of a median graph with constant dimension, $d=O(1)$. We show how Theorem~\ref{th:linear_simplex_teaser} can be integrated to it in order to improve the dependence on $d$. Let us begin with a reminder of the former result.

\begin{lemma}[\cite{BeHa21}]
There is a combinatorial algorithm computing all eccentricities in a median graph $G$ with running time $\tilde{O}(2^{d(\log d + 1)}n)$.
\label{le:slightly_super_exp}
\end{lemma}

Some parts of this subsection are redundant with~\cite{BeHa21}, however we keep this subsection self-contained. The new outcomes presented are Theorems~\ref{th:compute_opp} and~\ref{th:simple_ecc}.

The algorithm evoked by Lemma~\ref{le:slightly_super_exp} consists in the computation of three kinds of labels: \textit{ladder} labels $\varphi$, \textit{opposite} labels $\opp$ and \textit{anti-ladder} labels $\psi$. The order in which they are given correspond to their respective dependence: $\opp$-labelings are functions of labels $\varphi$ and $\psi$-labelings are functions of both labels $\varphi$ and $\opp$.
The definition of $\opp$-labelings on general median graphs is closely related to the computation of eccentricities on simplex graphs evoked in Section~\ref{sec:simplex}.

\subsubsection{Ladder labels} \label{subsubsec:ladder}

Some preliminary work has to be done before giving the definition of labels $\varphi$. We introduce the notion of \textit{ladder set}. It is defined only for pairs of vertices $u,v$ satisfying the condition $u \in I(v_0,v)$. In this situation, the edges of shortest $(u,v)$-paths are all oriented towards $v$ with the $v_0$-orientation.

\begin{definition}[Ladder set $L_{u,v}$]
Let $u,v \in V$ such that $u \in I(v_0,v)$. The ladder set $L_{u,v}$ is the subset of $\sigma_{u,v}$ which contains the $\Theta$-classes admitting an edge adjacent to $u$.
\label{def:ladder}
\end{definition}

Figure~\ref{fig:compute_labels} shows a small median graph with four vertices $v_0,u,v,x$ such that $u \in I(v_0,v)$ and $u \in I(v_0,x)$. It gives the composition of ladder sets $L_{u,v}$ and $L_{u,x}$.

\begin{figure}[h]
\centering
\scalebox{0.8}{\input{tikz/compute_labels}}
\caption{Examples of ladder sets: $L_{u,v} = \set{E_2,E_3}$, $L_{u,x} = \set{E_1,E_2,E_3}$.}
\label{fig:compute_labels}
\end{figure}

A key characterization on ladder sets states that their $\Theta$-classes are pairwise orthogonal. In brief, every set $L_{u,v}$ is a POF. Let us remind that the adjacency of all $\Theta$-classes of a POF $L$ with the same vertex $u$ implies the existence of a (unique) hypercube not only signed with this POF $L$ but also containing $u$ (Lemma~\ref{le:pof_adjacent}). If additionnally POF $L$ is \textit{outgoing from} $u$ - said differently, the edges adjacent to $u$ belonging to a $\Theta$-class of $L$ leave $u$ -, then $u$ is the basis of the hypercube.  As the $\Theta$-classes of $L_{u,v}$ are adjacent to $u$ by definition, there is a natural bijection between (i) hypercubes (ii) pairs made up of a vertex $u$ and a POF $L$ outgoing from $u$ and (iii) pairs vertex-ladder set $(u,L_{u,\cdot})$.

\begin{lemma}[\cite{BeHa21}]
Every ladder set $L_{u,v}$ is a POF. For any ordering $\tau$ of the $\Theta$-classes in $L_{u,v}$, there is a shortest $(u,v)$-path such that, for any $1\le i \le \card{L_{u,v}}$, the $\ith{i}$ first edge of the path belongs to the $\ith{i}$ $\Theta$-class of $L_{u,v}$ in ordering $\tau$.
\label{le:ladder_POF}
\end{lemma}

The necessary background to introduce labels $\varphi$ is now known.

\begin{definition}[Labels $\varphi$~\cite{BeHa21}]
Given a vertex $u$ and a POF $L$ outgoing from $u$, let $\varphi(u,L)$ be the maximum distance $d(u,v)$ such that $u \in I(v_0,v)$ and $L_{u,v} = L$.
\label{def:varphi}
\end{definition}

Intuitively, integer $\varphi(u,L)$ provides us with the maximum length of a shortest path starting from $u$ into ``direction'' $L$. Observe that the total size of labels $\varphi$ on a median graph $G$ does not exceed $O(2^dn)$, according to Lemma~\ref{le:number_hypercubes}. We provide another notion related to orthogonality which will be used in the remainder.

\begin{definition}[$L$-parallelism]
We say that a POF $L'$ is $L$-\emph{parallel} if, for any $E_j \in L'$, $L \cup \set{E_j}$ is not a POF.
\label{def:pof_parallel}
\end{definition}

When $L'$ is a $L$-parallel POF, we have $L \cap L' = \emptyset$, otherwise $L \cup \set{E_j} = L$ for some $E_j \in L'$. Presented differently, a $L$-paralle POF is such that any of its $\Theta$-classes is parallel to at least one $\Theta$-class of $L$.

A combinatorial algorithm running in $\tilde{O}(2^{2d}n)$ which computes all labels $\varphi(u,L)$ was identified in~\cite{BeHa21}: we provide an overview of it. There is a crucial relationship between a label $\varphi(u,L)$ and the labels of (i) the anti-basis $u^+$ of the hypercube with basis $u$ and signature $L$ and (ii) the $L$-parallel POFs outgoing from $u^+$.

\begin{lemma}[Inductive formula for labels $\varphi$~\cite{BeHa21}]
Let $u \in V$, $L$ be a POF outgoing from $u$ and $Q$ be the hypercube with basis $u$ and signature $L$. We denote by $u^+$ the opposite vertex of $u$ in $Q$: $u$ is the basis of $Q$ and $u^+$ its anti-basis. A vertex $v\neq u^+$ verifies $u \in I(v_0,v)$ and $L_{u,v} = L$ if and only if (i) $u^+ \in I(v_0,v)$ and (ii) ladder set $L_{u^+,v}$ is $L$-parallel.
\label{le:pushing_phi}
\end{lemma}

A consequence of the previous lemma is that we can distinguish two cases for the computation of $\varphi(u,L)$. In the first case, $\varphi(u,L) = \card{L}$: it occurs when the farthest-to-$u$ vertex with ladder set $L$ is $u^+$ (base case). Indeed, $u^+$ is a candidate as $\sigma_{u,u^+} = L$: shortest $(u,u^+)$-paths pass through hypercube $Q$. This situation happens when either no $\Theta$-class is outgoing from $u^+$ or when all $\Theta$-classes outgoing from $u^+$ are orthogonal to $L$. In the second case, there are vertices farther to $u$ than $u^+$ with ladder set $L$. As announced in Lemma~\ref{le:pushing_phi}, $\varphi(u,L)$ is a function of labels $\varphi(u^+,\cdot)$.

\begin{equation}
    \varphi(u,L) = \max\limits_{\substack{L^+ ~\mbox{\scriptsize{POF outgoing from}}~ u^+ \\ \forall E_j \in L^+,~ L \cup \set{E_j} ~\mbox{\scriptsize{not POF}}}} (\card{L} + \varphi(u^+,L^+)).
\label{eq:induction_phi}
\end{equation}

If there exists such a POF $L^+$, then the label $\varphi(u,L)$ is given by Equation~\eqref{eq:induction_phi}. Otherwise, it is given by the first case. Briefly, the algorithm consists in listing all pairs vertex-ladder set $((u,L),(u^+,L^+))$ such that $u^+$ is the anti-basis of the hypercube of basis $u$ and signature $L$. For each of it, we verify whether $L^+$ is $L$-parallel. If it is, we update $\varphi(u,L)$ if $\card{L} + \varphi(u^+,L^+)$ is greater than the current value. The total number of pairs $((u,L),(u^+,L^+))$ is upper-bounded by $2^{2d}n$: there are at most $2^dn$ pairs $(u^+,L^+)$ (bijection with hypercubes) and, for each of them, there are at most $2^d$ compatible pair $(u,L)$ such that $u^+$ is the anti-basis of $(u,L)$. Indeed, the number of edges incoming into $u^+$ is at most $d$ (Lemma~\ref{le:pof_hypercube}). For this reason, the computation of $\varphi$-labelings takes $\tilde{O}(2^{2d}n)$.

\begin{theorem}[Computation of labels $\varphi$~\cite{BeHa21}]
There is a combinatorial algorithm which determines all labels $\varphi(u,L)$ in $\tilde{O}(2^{2d}n)$. It also stores, for each pair $(u,L)$, a vertex $v$ satisfying $L_{u,v} = L$ and $d(u,v) = \varphi(u,L)$, denoted by $\mu(u,L)$.
\label{th:compute_phi}
\end{theorem}

\subsubsection{Opposite labels}

The second type of labels needed to compute all eccentricities of a median graph $G$ are opposite labels. %Their definition is very close to the function $\opp$ defined in Section~\ref{asec:simplex} for simplex graphs.  
Given a vertex $u$ and a POF $L$ outgoing from $u$, let $\opp_u(L)$ denote a POF with maximum label $\varphi$ which is disjoint from $L$. As for $\varphi$, the total size of $\opp$-labelings is $O(2^dn)$.

\begin{definition}[Labels $\opp$~\cite{BeHa21}]
Let $u \in V$ and $L$ be a POF outgoing from $u$. Let $\opp_u(L)$ be one of the POF $L'$ outgoing from $u$, disjoint from $L$, which maximizes value $\varphi(u,L')$.
\end{definition}

%On simplex graphs, the opposite function provides in fact the $\opp$-labelings of vertex $v_0$: $\opp(X) = \opp_{v_0}(X)$. 
As all vertices belong to hypercubes with basis $v_0$, the ladder set $L_{v_0,v}$ for any vertex $v\in V$ is exactly the set $\mathcal{E}^-(v)$ of $\Theta$-classes incoming into $v$. So, value $\varphi(v_0,X)$ is the distance $d(v_0,v)$ between $v_0$ and the only vertex $v$ with ladder set $L_{v_0,v} = X$.

On general median graphs, the opposite label $\opp_u(L)$ allows us to obtain the maximum distance $d(s,t)$ such that $u = m(s,t,v_0)$ and the ladder set $L_{u,s}$ is $L$.

\begin{lemma}[Relationship between medians and disjoint outgoing POFs~\cite{BeHa21}]
Let $L,L'$ be two POFs outgoing from a vertex $u$. Let $s$ (resp. $t$) be a vertex such that $u \in I(v_0,s)$ (resp. $u \in I(v_0,t)$) and $L_{u,s} = L$ (resp. $L_{u,t} = L'$). Then, $u \in I(s,t)$ if and only if $L \cap L' = \emptyset$. Therefore, given a single vertex $s$ such that $u \in I(v_0,s)$ and $L_{u,s} = L$, the maximum distance $d(s,v)$ we can have with median $m(s,v,v_0) = u$ is exactly $d(u,s)+\varphi(u,\opp_u(L))$.
\label{le:property_opp}
\end{lemma}

Going further, given a vertex $u \in V$, the maximum distance $d(s,t)$ such that $u = m(s,t,v_0)$ is the maximum value $\varphi(u,L) + \varphi(u,\opp_u(L))$, where $L$ is POF outgoing from $u$.

An algorithm was initially proposed to compute all labels $\opp_u(L)$ consisting in a brute force bounded tree search~\cite{BeHa21}. Its execution time was $\tilde{O}(2^{O(d\log d)}n)$, leading to the global same asymptotic running time (Lemma~\ref{le:slightly_super_exp}) for finding all eccentricities.

Fortunately, the quasilinear time algorithm determining the eccentricities on simplex graphs (Theorem~\ref{th:linear_simplex_teaser}, Section~\ref{sec:simplex}) offers us the opportunity to decrease the exponential term to a simple exponential function $2^d$. For any $u \in V$, let $G_u =  G\left[V_u\right]$ be the \textit{star} graph of $u$, using a definition from~\cite{ChLaRa19}. Its vertex set $V_u$ is made up of the vertices belonging to a hypercube with basis $u$ in $G$. Graph $G_u$ is the induced subgraph of $G$ on vertex set $V_u$ (see Figure~\ref{fig:compute_opposites} for an example). Chepoi {\em et al.}~\cite{ChLaRa19} showed that graph $G_u$ is a gated/convex subgraph of $G$. This notion of star graph is essential for the proof of the following key theorem.

\begin{theorem}[Computation of labels \opp]
There is a combinatorial algorithm which determines all labels $\opp_u(L)$ in $\tilde{O}(2^dn)$. 
\label{th:compute_opp}
\end{theorem}
\begin{proof}
Let $u \in V$: we denote by $N_u$ the number of hypercubes of $G$ with basis $u$. Convex subgraphs of median graphs are also median by considering the original definition of median graphs (Definition~\ref{def:median}). Consequently, star graph $G_u$ is median and all its maximal hypercubes contain a common vertex $u$. From Theorem~\ref{th:simplex}, $G_u$ is a simplex graph.

\begin{figure}[h]
\centering
\begin{subfigure}[b]{0.54\columnwidth}
\centering
\scalebox{0.8}{\input{tikz/compute_opposites_1}}
\caption{A $v_0$-oriented median graph $G$ and a vertex $u \in V$}
\label{subfig:compute_opposites_1}
\end{subfigure}
\begin{subfigure}[b]{0.44\columnwidth}
\centering
\scalebox{0.8}{\input{tikz/compute_opposites_2}}
\caption{Star graph $G_u$}
\label{subfig:compute_opposites_2}
\end{subfigure}

\caption{Example of star graph $G_u$}
\label{fig:compute_opposites}
\end{figure}

Any pair $(u,L)$ of $G$, where $L$ is a POF outgoing from $u$ in $G$, can be associated to a unique hypercube with signature $L$ and basis $u$. Thus, there is a natural bijection between (i) the POFs of $G_u$ (ii) the vertices of $G_u$ and (iii) the POFs $L$ of $G$ outgoing from $u$. Hence, $\card{V_u} = N_u$.

We associate with any POF $L$ of $G_u$ the weight $\omega_u(L) = \varphi(u,L)$. We apply the algorithm evoked in Theorem~\ref{th:linear_simplex_teaser}. The opposite computed with that configuration correspond exactly to the labels $\opp_u(L)$: a POF $L'$ disjoint from $L$ and maximizing $\varphi(u,L')$ among all POFs outgoing from $u$. The running time of the algorithm is $O((d^3+\log \card{V_u})\card{V_u}) = O((d^3+\log n)N_u)$. Doing it for every vertex $u$ of $G$, we obtain all opposite labels of $G$ in $O(d^3+\log n)2^dn)$ as $\sum_{u \in V} N_u = 2^dn$ (Lemma~\ref{le:number_hypercubes}).
\end{proof}

\subsubsection{Anti-ladder labels} \label{subsubsec:anti_ladder}

We terminate with anti-ladder labels $\psi$ which play the converse role of ladder labels $\varphi$. While $\varphi(u,L)$ is defined for POFs $L$ outgoing from $u$, labels $\psi(u,R)$ are defined for POFs $R$ incoming into $u$, {\em i.e.} every $\Theta$-class of the POF has an edge entering $u$. As any such pair $(u,R)$ can be associated with a hypercube of anti-basis $u$ and signature $R$ (Lemma~\ref{le:pof_hypercube}), the total size of $\psi$-labelings is at most $O(2^dn)$ too.

The notion of \textit{milestone} intervenes in the definition of labels $\psi$. We consider two vertices $u,v$ such that $u \in I(v_0,v)$. Milestones are defined recursively.

\begin{definition}[Milestones $\Pi(u,v)$]
Let $L_{u,v}$ be the ladder set of $u,v$ and $u^+$ be the anti-basis of the hypercube with basis $u$ and signature $L_{u,v}$.
If $u^+ = v$, then pair $u,v$ admits two milestones: $\Pi(u,v) = \set{u,v}$. Otherwise, the set $\Pi(u,v)$ is the union of $\Pi(u^+,v)$ with vertex $u$: $\Pi(u,v) = \set{u} \cup \Pi(u^+,v)$.
\label{def:milestones}
\end{definition}

The milestones are the successive anti-bases of the hypercubes formed by the vertices and ladder sets traversed from $u$ to $v$. Both vertices $u$ and $v$ are contained in $\Pi(u,v)$. The first milestone is $u$, the second is the anti-basis $u^+$ of the hypercube with basis $u$ and signature $L_{u,v}$. The third one is the anti-basis $u^{++}$ of the hypercube with basis $u^+$ and signature $L_{u^+,v}$, etc. All milestones are metrically between $u$ and $v$: $\Pi(u,v) \subseteq I(u,v)$. 

\begin{definition}[Penultimate milestone $\overline{\pi}(u,v)$]
We say that the milestone in $\Pi(u,v)$ different from $v$ but the closest to it is called the \textit{penultimate milestone}. We denote it by $\overline{\pi}(u,v)$. Furthermore, we denote by $\overline{L}_{u,v}$ the \emph{anti-ladder set} of $u,v$, {\em i.e.} the $\Theta$-classes of the hypercube with basis $\overline{\pi}(u,v)$ and anti-basis $v$. 
\end{definition}

\begin{figure}[h]
\centering
\scalebox{0.9}{\input{tikz/milestones}}
\caption{A pair $u,v$ with $u \in I(v_0,v)$ and its milestones $\Pi(u,v)$ in red.}
\label{fig:milestones}
\end{figure}

Figure~\ref{fig:milestones} shows the milestones $\Pi(u,v) = \set{u,u^+,u^{++},v}$. The hypercubes with the following pair basis-signature are highlighted with dashed edges: $(u,L_{u,v})$, $(u^+,L_{u^+,v})$, and $(u^{++},L_{u^{++},v})$. We have $\overline{\pi}(u,v) = u^{++}$ and $\overline{L}_{u,v} = L_{u^{++},v}$ is drawn in purple.

Let $R$ be a POF incoming to some vertex $u$ and $u^-$ be the basis of the hypercube with anti-basis $u$ and signature $R$.  Label $\psi(u,R)$ intuitively represents the maximum distance of a shortest path arriving to vertex $u$ from ``direction'' $R$. 

\begin{definition}[Labels $\psi$~\cite{BeHa21}]
The label $\psi(u,R)$ is the maximum distance $d(u,v)$ we can obtain with a vertex $v$ satisfying the following properties:
\begin{itemize}
\item $m = m(u,v,v_0) \neq u$,
\item the anti-ladder set of $m,v$ is $R$: $\overline{L}_{m,v} = R$.
\end{itemize}
Equivalently, vertex $u^-$ is the penultimate milestone of pair $m,u$: $u^- = \overline{\pi}(m,u)$.
\label{def:psi}
\end{definition}

As for the computation of labels $\varphi$, there is an induction process to determine all $\psi(u,R)$. As the base case, suppose that $u^- = v_0$. The largest distance $d(u,v)$ we can obtain with a vertex $v$ such that $v_0 \in I(u,v)$ consists in considering the opposite $\opp_{v_0}(R)$ of $R$ which is outgoing from $v_0$. Hence, $\psi(u,R) = \card{R} + \varphi(v_0,\opp_{v_0}(R))$.

For the induction step, we distinguish two cases. In the first one, assume that $m(u,v,v_0) = u^-$ - equivalently, $\Pi(m,u) = \Pi(u^-,u) = \set{u^-,u}$. A shortest $(u,v)$-path is the concatenation of the shortest $(u,u^-)$-path of length $\card{R}$ with a shortest $(u^-,v)$-path, and $u^- \in I(v_0,v)$. The largest distance $d(u,v)$ we can have, as for the base case, is $\psi(u,R) = \card{R} + \varphi(u^-,\opp_{u^-}(R))$.

In the second case, $m \neq u^-$, an inductive formula allows us to obtain $\psi(u,R)$. A consequence of Lemma~\ref{le:pushing_phi} is that, for two consecutive milestones in $\Pi(u,v)$, say $u$ and $u^+$ w.l.o.g, then $L_{u^+,v}$ is $L_{u,v}$-parallel. This observation, applied to the penultimate milestone, provides us with the following theorem.

\begin{lemma}[Inductive formula for labels $\psi$~\cite{BeHa21}]
Let $u,v \in V$ and $u \in I(v_0,v)$. Let $L$ be a POF outgoing from $v$ and $w$ the anti-basis of hypercube $(v,L)$. The following propositions are equivalent:
\begin{enumerate}
\item[(i)] vertex $v$ is the penultimate milestone of $(u,w)$: $\overline{\pi}(u,w) = v$,
\item[(ii)] the milestones of $(u,w)$ are the milestones of $(u,v)$ with $w$: $\Pi(u,w) = \Pi(u,v) \cup \set{w}$,
\item[(iii)] the POF $L$ is $\overline{L}_{u,v}$-parallel.
\end{enumerate}
\label{le:penultimate}
\end{lemma}

Set $\Pi(m,u)$ admits at least three milestones: $m$, $u^-$, and $u$. Let $R^-$ be the POF incoming to $u^-$ which is the ladder set (but also the signature) of (i) the milestone just before $u^-$ and (ii) $u^-$. According to Lemma~\ref{le:penultimate}, vertex $u^-$ is the penultimate milestone of $(m,u)$ if and only if $R^- \cup \set{E_j}$ is not a POF, for each $E_j \in R$. For this reason, value $\psi(u,R)$ can be expressed as:

\begin{equation}
\psi(u,R) = \max\limits_{\substack{R^- ~\mbox{\scriptsize{POF incoming to}}~ u^- \\ \forall E_j \in R, R^- \cup \set{E_j} ~\mbox{\scriptsize{not POF}}}} (\card{R} + \psi(u^-,R^-))
\label{eq:induction_psi}
\end{equation}

Our algorithm consists in taking the maximum value between the two cases. The number of pairs $((u,R),(u^-,R^-))$ which satisfy the condition described in Equation~\eqref{eq:induction_psi} is at most $2^{2d}n$: it is identical to the one presented for $\varphi$-labelings.

\begin{theorem}[Computation of labels $\psi$~\cite{BeHa21}]
There is a combinatorial algorithm which determines all labels $\psi(u,R)$ in $\tilde{O}(2^{2d}n)$. 
\label{th:compute_psi}
\end{theorem}

\subsubsection{Better time complexity for all eccentricities} \label{subsubsec:ecc}

 The computation of all labels $\varphi(u,L)$, $\opp_u(L)$ and $\psi(u,R)$ gives an algorithm which determines all eccentricities. Indeed, each eccentricity $\ecc(u)$ is a function of certain labels $\varphi$ and $\psi$. Let $v$ be a vertex in $G$ such that $\ecc(u) = d(u,v)$. If $m = m(u,v,v_0) = u$, then $u \in I(v_0,v)$ and value $d(u,v)$ is given by a label $\varphi(u,L)$. Otherwise, if $m \neq u$, let $u^-$ be the penultimate milestone in $\Pi(m,u)$ and $R$ be the classes of the hypercube with basis $u^-$ and anti-basis $u$. The eccentricity of $u$ is given by a label $\psi(u,R)$. Conversely, each $\varphi(u,L)$ and $\psi(u,R)$ is the distance between $u$ and another vertex by definition. Therefore, we have:

\begin{equation}
\ecc(u) = \mbox{max}\set{\max\limits_{\substack{L ~\mbox{\scriptsize{POF}} \\ \mbox{\scriptsize{outgoing from}}~ u}} \varphi(u,L), \max\limits_{\substack{R ~\mbox{\scriptsize{POF}} \\ \mbox{\scriptsize{incoming to}}~ u}} \psi(u,R)}
\label{eq:ecc_labels}
\end{equation}

In other words, the eccentricity of $u$ is the maximum label $\varphi$ or $\psi$ centered at $u$. We can conclude with the main result of this subsection: the eccentricities of any median graph can be determined in linear time multiplied by a simple exponential function $2^{O(d)}$ of the dimension $d$.

\begin{theorem}[All eccentricities in $\tilde{O}(2^{2d}n)$-time for median graphs]
There is a combinatorial algorithm computing the list of all eccentricities of a median graph $G$ in time $\tilde{O}(2^{2d}n)$.
\label{th:simple_ecc}
\end{theorem}
\begin{proof}
We simply determine the labels $\varphi$, $\opp$ and $\psi$ with the algorithms mentioned in Theorem~\ref{th:compute_phi},~\ref{th:compute_opp}, and~\ref{th:compute_psi}. Thanks to the time improvement obtained for the computation of opposite labels, the overall running time to compute the labels is only $\tilde{O}(2^{2d}n)$. Then, for each vertex $u$, Equation~\eqref{eq:ecc_labels} guides us to obtain its eccentricity. We take the maximum over all labels $\varphi(u,L)$ - they are at most $N_u$ - and all labels $\psi(u,R)$ - they are at most $2^d$. As $\sum_u N_u \le 2^dn$, the execution time of this operation on all vertices is $\tilde{O}(2^dn)$. Therefore, it does not overpass the time complexity needed to determine the labels.
\end{proof}

\subsection{Tackling the general case} \label{subsec:reduction}

Our new FPT algorithm for computing the list of eccentricities in a median graph has a runtime in $2^{{\cal O}(d)}n$, with $d$ being the dimension (Theorem~\ref{th:simple_ecc}). 
This runtime stays subquadratic in $n$ as long as $d < \alpha \cdot \log{n}$, for some constant $\alpha < 1$.
In what follows, we present a simple partitioning scheme for median graphs into convex subgraphs of dimension at most $\alpha \cdot \log{n}$, for an arbitrary value of $\alpha \leq 1$.
By doing so, we obtain (in combination with Theorem~\ref{th:simple_ecc}) the first known subquadratic-time algorithm for computing all eccentricities in a median graph.

The proof of the Lemmas which are not given in this subsection are put in Appendix~\ref{asec:subquadratic}. We start with a simple relation between the eccentricity function of a median graph and the respective eccentricity functions of any two complementary halfspaces.

\begin{lemma}[\ref{lem:guigui-1}]\label{lem:guigui-1_teaser}
Let $G$ be a median graph.
For every $1 \leq i \leq q$, let $v \in V(H_i')$ be arbitrary, and let $v^* \in \partial H_i''$ be its gate.
Then, $\ecc(v) = \max\{\ecc_{H_i'}(v), d(v,v^*) + \ecc_{H_i''}(v^*)\}$.
\end{lemma}

We will use this above Lemma~\ref{lem:guigui-1_teaser} later in our proof in order to compute in linear time the list of eccentricities in a median graph being given the lists of eccentricities in any two complementary halfspaces.

Next, we give simple properties of $\Theta$-classes, to be used in the analysis of our main algorithm in this section (see Lemma~\ref{lem:guigui-4}).

\begin{lemma}[\ref{lem:guigui-2}]\label{lem:guigui-2_teaser}
Let $H$ and $G$ be median graphs.
If $H$ is an induced subgraph of $G$ then, every $\Theta$-class of $H$ is contained in a $\Theta$-class of $G$.
\end{lemma}

This above Lemma~\ref{lem:guigui-2_teaser} can be strenghtened in the special case of {\em isometric} subgraphs.

\begin{lemma}[\ref{lem:guigui-2bis}]\label{lem:guigui-2bis_teaser}
Let $H$ and $G$ be median graphs, and let $E_1,E_2,\ldots,E_q$ denote the $\Theta$-classes of $G$.
If $H$ is an isometric subgraph of $G$ then, the $\Theta$-classes of $H$ are exactly the nonempty subsets among $E_i \cap E(H)$, for $1 \leq i \leq q$.
\end{lemma}

An important consequence of Lemma~\ref{lem:guigui-2_teaser} is the following relation between the dimension $d$ of a median graph and the cardinality of its $\Theta$-classes.

\begin{lemma}\label{lem:guigui-3_teaser}
Let $G$ be a median graph, and let $D := \max\{ |E_i| \mid 1 \leq i \leq q\}$ be the maximum cardinality of a $\Theta$-class of $G$. Then, $d = \dim(G) \leq \lfloor\log{D}\rfloor + 1$.
\end{lemma}
\begin{proof}
Any induced $d$-dimensional hypercube of $G$ contains exactly $2^{d-1}$ edges of its $\Theta$-classes, so $2^{d-1}\le D$.
\end{proof}

We are now ready to present our main technical contribution in this section.

\begin{lemma}\label{lem:guigui-4}
If there is an algorithm for computing all eccentricities in an $n$-vertex median graph of dimension at most $d$ in $\tilde{O}(c^d \cdot n)$ time, then in $\tilde{O}(n^{2 - \frac 1 {1+\log{c}}})$ time we can compute all eccentricities in {\em any} $n$-vertex median graph.
\end{lemma}
\begin{proof}
Let $G$ be an $n$-vertex median graph.
We compute its $\Theta$-classes $E_1,E_2,\ldots,E_q$, that takes linear time (Lemma~\ref{le:linear_classes}).
For some parameter $D$ (to be fixed later in the proof), let us assume without loss of generality $E_1,E_2,\ldots,E_p$ to be the subset of all $\Theta$-classes of cardinality $\geq D$, for some $p \leq q$. Note that we have $p \leq \card{E}/D = \tilde{O}(n/D)$.

We reduce the problem of computing all eccentricities in $G$ to the same problem on every connected component of $G \setminus (E_1 \cup E_2 \cup \ldots \cup E_p)$. 
More formally, we construct a rooted binary tree $T$, whose leaves are labelled with convex subgraphs of $G$.
Initially, $T$ is reduced to a single node with label equal to $G$.
Then, for $i = 1 \ldots p$, we further refine this tree so that, at the end of any step $i$, its leaves are labelled with the connected components of $G \setminus \left(E_1 \cup E_2 \cup \ldots \cup E_i\right)$. An example of $T$ is shown in Figure~\ref{fig:reduction} with $D=3$ and two $\Theta$-classes reaching this cardinality bound.

For that, we proceed as follows.
We consider all leaves of $T$ whose label $H$ satisfies $E(H) \cap E_i \neq \emptyset$.
By Lemma~\ref{lem:guigui-2bis_teaser}, $E(H) \cap E_i$ is a $\Theta$-class of $H$.
Both halfspaces of $E_i$ become the left and right children of $H$ in $T$. 
Recall that the leaves of $T$ at this step $i$ are the connected components of $G \setminus (E_1 \cup E_2 \cup \ldots \cup E_{i-1})$, and in particular that they form a partition of $V(G)$.
Therefore, each step takes linear time by reduction to computing the connected components in vertex-disjoint subgraphs of $G$.
Overall, the total time for constructing the tree $T$ is in ${O}(pm) = \tilde{O}(n^2/D)$.

\begin{figure}[h]
\centering
\scalebox{0.6}{\input{tikz/reduction}}
\caption{An example of tree $T$ associated with a graph $G$ for $D=3$: here, $p=2$.}
\label{fig:reduction}
\end{figure}

Then, we compute the list of eccentricities for all the subgraphs labelling a node, by dynamic programming on $T$. 
In particular, doing so we compute the list of eccentricities for $G$ because it is the label of the root.
There are two cases:
\begin{itemize}
    \item If $H$ labels a leaf (base case) then, we claim that we have $\mbox{dim}(H) \leq \lfloor \log{D} \rfloor + 1$.
Indeed, by Lemma~\ref{lem:guigui-2_teaser}, every $\Theta$-class of $H$ is contained in a $\Theta$-class of $G$.
Since we removed all $\Theta$-classes of $G$ with at least $D$ edges, the claim now follows from Lemma~\ref{lem:guigui-3_teaser}.
In particular, we can compute the list of all eccentricities for $H$ in $\tilde{O}(c^{\lfloor \log{D} \rfloor + 1}|V(H)|) = \tilde{O}(D^{\log{c}}|V(H)|)$ time.
Recall that the leaves of $T$ partition $V(G)$, and therefore, the total runtime for computing the list of eccentricities for the leaves is in $\tilde{O}(D^{\log{c}}n)$.
    \item From now on, let us assume $H$ labels an internal node of $T$ (inductive case).
Let $H_i',H_i''$ be its children nodes, obtained from the removal of $E(H) \cap E_i$ for some $1 \leq i \leq p$.
-- For convenience, we will say later in the proof that $H$ is an $i$-node. --
Recall that $E(H) \cap E_i$ is a $\Theta$-class of $H$.
In particular, $H_i',H_i''$ are gated subgraphs.
By Lemma~\ref{lem:guigui-1_teaser}, we can compute in ${O}(|V(H_i')|)$ time the eccentricities in $H$ of all vertices in $H_i'$ if we are given as input: the list of eccentricities in $H_i'$, the list of eccentricities in $H_i''$, and for every $v \in V(H_i')$ its gate $v^* \in \partial H_i''$ and the distance $d(v,v^*)$. 
The respective lists of eccentricities for $H_i'$ and $H_i''$ were pre-computed by dynamic programming on $T$.
Furthermore, we can compute the gate $v^*$ and $d(v,v^*)$ for every vertex $v \in V(H_i')$, in total $\tilde{O}(|V(H)|)$ time, by using a modified BFS rooted at $H_i''$ (we refer to~\cite[Lemma 17]{ChLaRa19} for a detailed description of this standard procedure).
Overall (by proceeding the same way for $H_i''$ as for $H_i'$) we can compute the list of eccentricities for $H$ in $\tilde{O}(|V(H)|)$ time.
This is in total $\tilde{O}(n)$ time for the $i$-nodes ({\it i.e.}, because they were leaves of $T$ at step $i$, and therefore, they are vertex-disjoint), and so, in total $\tilde{O}(pn) = \tilde{ O}(n^2/D)$ time for all the internal nodes.
\end{itemize}
The total runtime for our algorithm is $\tilde{O}(n^2/D + D^{\log{c}}n)$, and optimized for $D = n^{\frac 1 {\log{c}+1}}$.
\end{proof}

\begin{theorem}\label{thm:guigui-5}
There is an $\tilde{O}(n^{5/3})$-time algorithm for computing all eccentricities in median graphs.
\end{theorem}
\begin{proof}
This result directly follows from Theorem~\ref{th:simple_ecc} with Lemma~\ref{lem:guigui-4} (for $c = 4$).
\end{proof}

%Observe that the design of a linear-time FPT algorithm for eccentricities in $\tilde{O}(c^dn)$ with $c < 4$ would imply a lower subquadratic constant for this problem.

%\section{Generalization and improvements} \label{sec:discussion}
%
%In this section, we discuss some consequences and possible improvements of the algorithms established in Section~\ref{sec:subquadratic}. 
%
%First, we focus on another metric parameter called \textit{reach centrality}. We show the existence of an exact algorithm for all reach centralities in $\tilde{O}(2^{3d}n)$ on median graphs.  
%
%Second, we propose a discrete structure strongly related to both POFs and hypercubes but slightly different to them: \textit{Maximal Outgoing POFs}, also called MOPs. We introduce a different way to compute all eccentricities of a median graph based on this structure. This yields a second subquadratic-time algorithm with a smaller exponent.
%
%\subsection{Reach centrality} \label{subsec:reach_centrality}
%
%The content of this subsection is put in Appendix~\ref{asubsec:reach_centrality}. It presents the following result.
%
%\begin{theorem}[\ref{th:simple_rc}]
%There is a combinatorial algorithm computing all  reach centralities $\rc(u)$ of a median graph in $\tilde{O}(2^{3d}n)$.
%\label{th:simple_rc_teaser}
%\end{theorem}
%
%\subsection{MOP structure} \label{subsec:mop}
%
%In this subsection, we introduce a new discrete structure for median graphs, called Maximal Outgoing POFs (MOPs). We present another way to determine all eccentricities based on the enumeration of MOPs. Thanks to this result, we obtain an improvement of Theorem~\ref{thm:guigui-5} via a win-win approach. When $d \le a^*\log n$ (value $a^*<1$ will be determined in the proof), we can apply Theorem~\ref{th:simple_ecc_teaser}. Otherwise, when $d > a^* \log n$, we show that $G$ admits a subquadratic number of MOPs and the eccentricities can be computed more efficiently than in Section~\ref{subsec:constant_dim}. The reader will found the missing proofs in Appendix~\ref{asubsec:mop}.
%
%\subsubsection{Definition and relationship with eccentricities} \label{subsubsec:def_mop}
%
%Recall that a pair made up of a vertex $u$ and a POF $L$ outgoing from this vertex can be seen as a hypercube (of basis $u$ and signature $L$, which is unique). The MOPs are defined to highlight certain hypercubes which satisfy a maximality property.
%
%\begin{definition}[Maximal Outgoing POFs]
%Pair $(u,L)$ is a MOP if $L$ is outgoing from $u$ and there is no other $L' \supsetneq L$ outgoing from $u$.
%\label{def:mop}
%\end{definition}
%
%On one hand, we can associate with each MOP $(u,L)$ the unique hypercube with basis $u$ and signature $L$. However, there are some hypercubes such that their pair basis-signature is not a MOP. As a trivial example, consider the square $C_4$ with $\Theta$-classes $E_1,E_2$. The two edges which are incident to $v_0$ are hypercubes of dimension 1, $(v_0,\set{E_1})$ and $(v_0,\set{E_2})$, but are not MOPs since the POF $\set{E_1,E_2}$ is outgoing from $v_0$ and maximal.
%
%On the other hand, there is an interesting relationship between MOPs and maximal POFs. We remind the reader that maximal POFs are in bijection with maximal induced hypercubes (Theorem~\ref{th:maximal_pofs_teaser}). Thus, a maximal POF is a MOP if we consider the pair basis-signature of the maximal hypercube representing it. Conversely, MOPs are not necessarily signed with maximal POFs. Let us consider the same trivial example $C_4$: the two edges which are not incident to $v_0$ are MOPs but do not form a maximal hypercube. In brief, MOPs represent some intermediary discrete structure between hypercubes and maximal hypercubes (or maximal POFs).
%
%The execution time of the algorithms (Theorems~\ref{th:simple_ecc_teaser} and~\ref{thm:guigui-5}) we designed to determine the eccentricities of median graphs depend on the listing of all pairs $(L,R)$ of POFs such that $L$ (resp. $R$) is outgoing from (resp. incoming into) vertex $u$ and $R \cup \set{E_i}$ is not a POF for any $E_i \in L$ (see Appendix~\ref{asec:subquadratic} for details). We show how the MOPs offer an alternative to this ``brute force'' enumeration. In fact, we can determine all eccentricities  by listing only these pairs $(L,R)$ for which $(u,L)$ is a MOP (instead of being an hypercube).
%
%\begin{theorem}[\ref{th:labels_mops}]
%Assume a median graph $G$ has at most $\tilde{O}(f(d,n)n)$ MOPs, $f(d,n) = o(2^d)$. There is a combinatorial algorithm computing all its eccentricities in $\tilde{O}(2^df(d,n)n)$.
%\label{th:labels_mops_teaser}
%\end{theorem}
%
%\subsubsection{Cardinality of MOPs} \label{subsubsec:bound_mop}
%
%Our objective is now to express the cardinality of MOPs in function of $n$ and $d$ in order to apply Theorem~\ref{th:labels_mops_teaser} and improve the subquadratic execution time established in Theorem~\ref{thm:guigui-5}. To do so, we introduce a relationship between MOPs and the subsets of maximal POFs.
%
%\begin{definition}
%Let $p$ be the application which, given $u \in V$ and a POF $L$ outgoing from $u$, returns pair $(L,L^*)$, where $L^*$ is the POF of $\Theta$-classes incoming into the anti-basis of $(u,L)$.
%\end{definition}
%
%If we restrict application $p$ to MOPs, it returns a pair made up of a maximal POF and one of its subsets.
%
%\begin{lemma}[\ref{le:mop_max_subsets}]
%Let $(u,L)$ be a MOP, $p(u,L) = (L,L^*)$. Then, $L^*$ is a maximal POF.
%\label{le:mop_max_subsets_teaser}
%\end{lemma}
%
%Maximal POFs can be interpreted in the crossing graph $G^{\#}$ of $G$, whose vertex set contains the $\Theta$-classes of $G$ and two of them are adjacent if they are orthogonal (see \cite{KlKo09} or Definition~\ref{def:crossing} in Appendix~\ref{asec:simplex}). A POF of $G$ is exactly a clique of $G^{\#}$ and a maximal POF corresponds to a maximal clique of $G^{\#}$. We provide an upper bound of the number of MOPs of $G$ depending on the maximal cliques of its crossing graph.
%
%\begin{corollary}[\ref{co:mop_crossing}]
%Let $G^{\#}$ be the crossing graph of $G$ and $\mcalcm^{\#}$ be the set of maximal cliques of $G^{\#}$. The number of MOPs in $G$ is at most $\sum\limits_{C \in \mcalcm^{\#}} 2^{\card{C}}$.
%\label{co:mop_crossing_teaser}
%\end{corollary}
%
%\begin{definition}[Maximal clique ratio]
%The maximal clique ratio $r(H)$ of a graph $H$ is the quotient between the sum of the number of subsets of each maximal clique of $H$ by the number of cliques of $H$. Formally,
%\[
%r(H) = \frac{R\left[ H\right]}{N\left[ H\right]} = \frac{\sum\limits_{C \in \mcalcm(H)} 2^{C}}{\card{\mcalc(H)}}
%\]
%\end{definition}
%
%The \textit{clique number} of a graph is the size of its maximum clique. The dimension $d$ of $G$ is also the clique number of $G^{\#}$. Complete multipartite graphs (with clique number $d$) are the graphs whose vertex set can be partitioned into independent sets $A_i$, $1\le i\le d$, and any pair of vertices belonging to a different set form an edge.
%
%We begin with the proof that the complete multipartite graphs maximize the ratio $r(H)$. Next, we show that the more complete multipartite graph are balanced, the largest $r(H)$ is.
%
%The complete multipartite graphs are exactly the graphs fulfilling the following property: for any non-adjacent vertices $u,v$, $N(u)=N(v)$. Let $\trp(H)$ be the number of triplets $(u,v,w)$ of vertices of $H$ such that $uv\notin E$, $uw \notin E$, but $vw \in E$. An equivalent way to characterize complete multipartite graphs is $\trp(H) = 0$. In other words, any graph which is not complete multipartite verify $\trp(H) > 0$. 
%
%\begin{theorem}[\ref{th:complete_multi}]
%Let $H$ be a graph with $\card{V(H)} = q$, clique number at most $d$, which maximizes $r(H)$. If $H$ is not complete multipartite, there is another graph $H'$ with $\card{V(H')} = q$, clique number at most $d$, such that $r(H') = r(H)$ and $\emph{Trp}(H') < \emph{Trp}(H)$. 
%\label{th:complete_multi_teaser}
%\end{theorem}
%
%By successive applications of this result, for any graph $H$ of clique number at most $d$ maximizing $r(H)$, there exists a complete multipartite graph $H'$ with the same ratio and clique number at most $d$. 
%Tur\'an graphs $T(q,d)$ are the most balanced complete multipartite graphs with $q$ vertices and clique number $d$. The size of two of its independent sets differ of at most one. Now, the objective is to prove that, among complete multipartite graphs, Tur\'an graphs maximize the maximal clique ratio.
%
%\begin{theorem}[\ref{th:turan}]
%Tur\'an graphs $T(q,d)$ maximize the maximal clique ratio for graphs with $q$ vertices and clique number $d$.
%\label{th:turan_teaser}
%\end{theorem}
%
%Naturally, we use the maximal clique ratio of Tur\'an graphs to deduce an upper bound for the number of MOPs of any median graph $G$.
%
%\begin{corollary}[\ref{co:number_mops}]
%The number of MOPs in a median graph is $O(f(d,n)n)$, where $f(d,n) = \left(2.\frac{2^{\frac{\log n}{d}}-1}{2^{\frac{\log n}{d}}}\right)^d$.
%\label{co:number_mops_teaser}
%\end{corollary}
%
%By observing the expression of function $f(d,n)$, we see that the larger the dimension $d$, the smaller the number of MOPs. The following result comes from the win-win approach we announced earlier.
%
%\begin{theorem}
%There is a combinatorial algorithm determining all eccentricities in time $\tilde{O}(n^{1.6456})$ on median graphs.
%\label{th:subquadramop}
%\end{theorem}
%\begin{proof}
%Let $a = \frac{d}{\log n}$ and we define two functions: $f(x) = 2.\frac{2^{\frac{1}{x}}-1}{2^{\frac{1}{x}}}$ and $g(x) = 2-\frac{1}{1+\log (2f(x))}$.
%
%One one hand, according to Theorem~\ref{th:simple_ecc_teaser}, there is a combinatorial algorithm determining all eccentricities in $\tilde{O}(2^{2d}n) = \tilde{O}(n^{1+2a})$. 
%On the other hand, according to Theorem~\ref{th:labels_mops_teaser} and Corollary~\ref{co:number_mops_teaser}, we can also compute all eccentricities in time $\tilde{O}(2^d(f(a))^dn)$. Using the reduction scheme of Theorem~\ref{lem:guigui-4}, we obtain them in subquadratic time $\tilde{O}(n^{g(a)})$.
%
%To obtain the best runtime possible, we have to minimize the subquadratic constant $h(a) =\max \set{1+2a,g(a)}$. Function $h$ admits a unique minimum for $0 < a \le 1$, reached for a certain $a^*$ we can approximate by $0.3327 \le a^* \le 0.3328$. This gives $h(a^*) \simeq 1.6456$.
%
%We describe the combinatorial algorithm computing all eccentricities in $\tilde{O}(n^{h(a^*)})$. We determine $d$ with a BFS from $v_0$ as it is equal to the maximum number of edges incoming into a vertex of $G$ (Lemma~\ref{le:pof_hypercube} of Appendix~\ref{asubsec:orthogonal}).
%If $\frac{d}{\log n} \le a^*$, then apply the linear FPT algorithm evoked in Theorem~\ref{th:simple_ecc_teaser}. Otherwise, if $\frac{d}{\log n} > a^*$, then use the enumeration of MOPs (Theorem~\ref{th:labels_mops_teaser}) and apply the reduction scheme proposed in Lemma~\ref{lem:guigui-4}.
%\end{proof}

\section{Conclusion} \label{sec:conclusion}

As a natural extension of this work, the question of designing a linear-time or quasilinear-time algorithm to compute
the diameter and all eccentricities of median graphs is now open. With the recursive splitting procedure of Lemma~\ref{lem:guigui-4}, unfortunately, the best execution time we could obtain is $\tilde{O}(n^{\frac{3}{2}})$. Reaching this bound could represent a first reasonable objective: it would ``suffice'' to propose a FPT combinatorial algorithm which computes all eccentricities in $\tilde{O}(2^dn)$ in order to obtain such time complexity. We see the MOP-approach as a gateway to identify such a procedure.

Another - certainly easier - objective after this work is to adapt the recursive splitting of Lemma~\ref{lem:guigui-4} for reach centralities. We tried to define a weighted version of the reach centralities problem in order to fit them to the halfspace separation, but this task seems to be not so easy. Our hope is to obtain a subquadratic-time algorithm computing reach centralities in median graphs. 

Eventually, we note two lines of research on which this paper could have some influence: (i) the study of efficient algorithms for the computation of other metric parameters on median graphs (perhaps, the \textit{betweenness centrality}~\cite{AbGrWi15}) and (ii) the design of subquadratic-time algorithms for the diameter and all eccentricities on larger families of graphs (\textit{almost-median} or \textit{semi-median} graphs~\cite{Br07,KlSh12} for example). Concerning the betweenness centrality, our intuition is that the labeling framework introduced~\cite{BeHa21} does not suffice to describe the number of $(u,v)$-paths passing through some vertex, which is exactly what betweenness centrality assesses.

\newpage

%Bibliographie
\bibliography{bib_median}

\newpage

\appendix

\section{Appendix for Section~\ref{sec:median}} \label{asec:median}

\subsection{Orthogonal $\Theta$-classes and hypercubes} \label{asubsec:orthogonal}

We present now another important notion on median graphs: \textit{orthogonality}. In~\cite{Ko09}, Kovse studied a relationship between \textit{splits} which refer to the halfspaces of $\Theta$-classes. It says that two splits $\set{H_i',H_i''}$ and $\set{H_j',H_j''}$ are \textit{incompatible} if the four sets $H_i' \cap H_j'$, $H_i'' \cap H_j'$, $H_i' \cap H_j''$, and $H_i'' \cap H_j''$ are nonempty. Another definition was proven equivalent to this one.

\begin{definition}[Orthogonal $\Theta$-classes]
We say that classes $E_i$ and $E_j$ are {\em orthogonal} ($E_i \perp E_j$) if there is a square $uvyx$ in $G$, where $uv,xy \in E_i$ and $ux,vy \in E_j$.
\end{definition}

Indeed, classes $E_i$ and $E_j$ are orthogonal if and only if the splits produced by their halfspaces are incompatible.

\begin{lemma}[Orthogonal$\Leftrightarrow$Incompatible~\cite{BeHa21}] Given two $\Theta$-classes $E_i$ and $E_j$ of a median graph $G$, the following statements are equivalent:
\begin{itemize}
    \item Classes $E_i$ and $E_j$ are orthogonal,
    \item Splits $\set{H_i',H_i''}$ and $\set{H_j',H_j''}$ are incompatible,
    \item The four sets $\partial H_i' \cap \partial H_j'$, $\partial H_i'' \cap \partial H_j'$, $\partial H_i' \cap \partial H_j''$, and $\partial H_i'' \cap \partial H_j''$ are nonempty.
\end{itemize}
\label{le:perp_incomp}
\end{lemma}

The concept of \textit{orthogonality} is sometimes described with different words in the literature depending on the context: incompatible, \textit{concurrent} or \textit{crossing}. We say that $E_i$ and $E_j$ are \textit{parallel} if they are not orthogonal, that is $H_i \subseteq H_j$ for some $H_i \in \set{H_i',H_i''}$ and $H_j \in \set{H_j',H_j''}$. 

We pursue with a property on orthogonal $\Theta$-classes: if two edges of two orthogonal classes $E_i$ and $E_j$ are incident, they belong to a common square.

\begin{lemma}[Squares~\cite{BaCo93,BeHa21}]
Let $xu \in E_i$ and $uy \in E_j$. If $E_i$ and $E_j$ are orthogonal, then there is a vertex $v$ such that $uyvx$ is a square.
\label{le:squares}
\end{lemma}

\textbf{Pairwise orthogonal families}. We focus on the set of $\Theta$-classes which are pairwise orthogonal.

\begin{definition}[Pairwise Orthogonal Family]
We say that a set of classes $X \subseteq \mathcal{E}$ is a {\em Pairwise Orthogonal Family (POF for short)} if for any pair $E_j,E_h \in X$, we have $E_j \perp E_h$.
\end{definition}

This notion is not completely new, since it implicitely appears in certain properties established on median graphs (for instance, the \textit{downward cube} property in~\cite{BeChChVa20}). The empty set is considered as a POF. We denote by $\mathcal{L}$ the set of POFs of the median graph $G$. The notion of POF is strongly related to the induced hypercubes in median graphs. First, observe that all $\Theta$-classes of a median graph form a POF if and only if the graph is a hypercube of dimension $\log n$~\cite{Ko09,MoMuRo98}. Secondly, the next lemma precises the relationship  between POFs and hypercubes.


\begin{lemma}[POFs adjacent to a vertex~\cite{BeHa21}]
Let $X$ be a POF, $v \in V$, and assume that for each $E_i \in X$, there is an edge of $E_i$ adjacent to $v$. There exists a hypercube $Q$ containing vertex $v$ and all edges of $X$ adjacent to $v$. Moreover, the $\Theta$-classes of the edges of $Q$ are the classes of $X$.
\label{le:pof_adjacent}
\end{lemma}

There is a natural bijection between the vertices of a median graph and the POFs. The next lemma exhibits this relationship.

\begin{lemma}[POFs and hypercubes~\cite{BaChDrKo06,BaQuSaMa02,Ko09}]
Consider an arbitrary canonical basepoint $v_0 \in V$ and the $v_0$-orientation for the median graph $G$. Given a vertex $v \in V$, let $N^-(v)$ be the set of edges going into $v$ according to the $v_0$-orientation. Let $\mathcal{E}^-(v)$ be the classes of the edges in $N^-(v)$. The following propositions are true:
\begin{itemize}
\item For any vertex $v\in V$, $\mathcal{E}^-(v)$ is a POF. Moreover, vertex $v$ and the edges of $N^-(v)$ belong to an induced hypercube formed by the classes $\mathcal{E}^-(v)$. Hence, $\card{\mathcal{E}^-(v)} = \card{N^-(v)} \le d$.
\item For any POF $X$, there is a unique vertex $v_X$ such that $\mathcal{E}^-(v_X) = X$. Vertex $v_X$ is the closest-to-$v_0$ vertex $v$ such that $X \subseteq \mathcal{E}^-(v)$.
\item The number of POFs in $G$ is equal to the number $n$ of vertices: $n = \card{\mathcal{L}}$.
\end{itemize}
\label{le:pof_hypercube}
\end{lemma}

\begin{figure}[h]
\centering
\scalebox{0.95}{\input{tikz/vertices_pof}}
\caption{Illustration of the bijection between $V$ and the set of POFs.}
\label{fig:vertices_pof}
\end{figure}

An example is given in Figure~\ref{fig:vertices_pof} with a small median graph of dimension $d=2$. $v_0$ is the canonical basepoint  and edges are colored according to  their $\Theta$-class. For example, $v_1v_3 \in E_1$. We associate with any POF $X$ of $G$ the vertex $v_X$ satisfying $\mathcal{E}^-(v_X) = X$ with the $v_0$-orientation. Obviously, the empty POF is associated with $v_0$ which has no incoming edges.

A straightforward consequence of this bijection is that parameter $q$, the number of $\Theta$-classes, is less than the number of vertices $n$. But it can be used less trivially to enumerate the POFs of a median graph in linear time~\cite{BaQuSaMa02,Ko09}. Given a basepoint $v_0$, we say that the \textit{basis} (resp. \textit{anti-basis}) of an induced hypercube $Q$ is the single vertex $v$ such that all edges of the hypercube adjacent to $v$ are outgoing from (resp. incoming into) $v$. Said differently, the basis of $Q$ is its closest-to-$v_0$ vertex and its anti-basis is its farthest-to-$v_0$ vertex. What Lemma~\ref{le:pof_hypercube} states is also that we can associate with any POF $X$ a hypercube $Q_X$ which contains exactly the classes $X$ and admits $v_X$ as its anti-basis. This observation implies that the number of POFs is less than the number of hypercubes in $G$. Moreover, the hypercube $Q_X$ is the closest-to-$v_0$ hypercube formed with the classes in $X$. Figure~\ref{subfig:ingoing_edges} shows a vertex $v$ with its incoming and outgoing edges with the $v_0$-orientation. The dashed edges represent the hypercube with anti-basis $v$ and POF $\mathcal{E}^-(v)$.

\begin{figure}[h]
\begin{subfigure}[b]{0.49\columnwidth}
\centering
\scalebox{0.8}{\input{tikz/ingoing_edges}}
\caption{The hypercube ``induced'' by the edges incoming into a vertex (its antibasis).}
\label{subfig:ingoing_edges}
\end{subfigure}
\begin{subfigure}[b]{0.49\columnwidth}
\centering
\scalebox{0.8}{\input{tikz/maximal_pof}}
\caption{A POF signing at least two hypercubes $Q$ and $Q'$ is not maximal.}
\label{subfig:maximal_pof}
\end{subfigure}
\caption{Properties of POFs}
\label{fig:properties_pofs}
\end{figure} 

\textbf{Number of hypercubes}. We remind a formula establishing a relationship between the number of POFs and the number of hypercubes in the literature. Let $\alpha(G)$ (resp. $\beta(G)$) be the number of hypercubes (resp. POFs) in $G$. Let $\beta_i(G)$ be the number of POFs of cardinality $i \le d$ in $G$. According to~\cite{BaQuSaMa02,Ko09}, we have:
\begin{equation}
\alpha(G) = \sum_{i=0}^d 2^i\beta_i(G)
\label{eq:number_hypercubes}
\end{equation}

Equation~\eqref{eq:number_hypercubes} produces a natural upper bound for the number of hypercubes.

\begin{lemma}[Number of hypercubes]
$\alpha(G)\le 2^dn$.
\label{le:number_hypercubes}
\end{lemma}

Value $\alpha(G)$ consider all hypercubes, in particular those of dimension 0, {\em i.e.} vertices. From now on, the word ``hypercube'' refers to the hypercubes of dimension at least one.

Each hypercube in the median graph $G$ can be defined with only its anti-basis $v$ and the edges $\widehat{N}$ of the hypercube that are adjacent and going into $v$ according to the $v_0$-orientation. These edges are a subset of $N^-(v)$: $\widehat{N} \subseteq N^-(v)$. Conversely, given a vertex $v$, each subset of $N^-(v)$ produces a hypercube which admits $v$ as an anti-basis (this hypercube is a sub-hypercube of the one obtained with $v$ and $N^-(v)$, Lemma~\ref{le:pof_hypercube}). Another possible bijection is to consider a hypercube as a pair composed of its anti-basis $v$ and the $\Theta$-classes $\widehat{\mathcal{E}}$ of the edges in $\widehat{N}$ (its signature).

As a consequence, a simple graph search as BFS enables us to enumerate the hypercubes in $G$ in time $O(d2^dn)$.

\begin{lemma}[Enumeration of hypercubes~\cite{BeHa21}]
We can enumerate all triplets $(v,u,\widehat{\mathcal{E}})$, where $v$ is the anti-basis of a hypercube $Q$, $u$ its basis, and $\widehat{\mathcal{E}}$ the signature of $Q$ in time $O(d2^dn)$. Moreover, the list obtained fulfils the following partial order: if $d(v_0,v) < d(v_0,v')$, then any triplet $(v,u,\widehat{\mathcal{E}})$ containing $v$ appears before any triplet $(v',u',\widehat{\mathcal{E}}')$ containing $v'$.
\label{le:enum_hypercubes}
\end{lemma}

The enumeration of hypercubes is thus executed in linear time for median graphs with constant dimension. In summary, given any median graph, one can compute the set of $\Theta$-classes and their orthogonality relationship (for each $E_i$, the set of $\Theta$-classes orthogonal to $E_i$) in linear time, and the set of hypercubes with its basis, anti-basis and signature in $\tilde{O}(2^dn)$.

\subsection{Maximal POFs} \label{asubsec:max_pofs}

\begin{theorem}[Maximal POFs and hypercubes]
For any maximal induced hypercube, the $\Theta$-classes of its edges form a maximal POF.
Conversely, for any maximal POF $X$, there exists a unique hypercube of signature $X$. Its anti-basis is the vertex $v$ such that $\mathcal{E}^-(v) = X$. 
\label{th:maximal_pofs}
\end{theorem}
\begin{proof}
Let $Q$ be a maximal hypercube and $X_Q$ its signature. We begin with the proof that $X_Q$ is a maximal POF. Assume that $Y \supsetneq X_Q$. As $Y$ is a POF, there is a vertex $v_Y \in V$ satisfying $\mathcal{E}^-(v_Y) = Y$. Similarly, we denote by $v_X$ the vertex such that $\mathcal{E}^-(v_X) = X_Q$. Both $v_X$ and $v_Y$ belong to the boundary of any $\Theta$-class of $X_Q$ (the one which is the farthest from $v_0$). In brief, 
\begin{equation}v_X,v_Y \in \bigcap_{E_i \in X_Q} \partial H_i''
\label{eq:bigcap_gated}
\end{equation}
As every $\partial H_i''$ is gated, then the intersection written in Eq.~\eqref{eq:bigcap_gated} is convex/gated too. Thus, the shortest $(v_X,v_Y)$-path is entirely contained in set $\bigcap_{X_Q} \partial H_i''$. Let $(v_X,z)$ be the first edge of this path and $E_j$ the $\Theta$-class of this edge. Each $\Theta$-class form an isomorphism between its two boundaries (Lemma~\ref{le:boundaries}): as $z \in \bigcap_{X_Q} \partial H_i''$, there is a hypercube isomorphic to $Q$ in the boundary of $E_j$ containing $z$. Therefore, there is a hypercube of dimension $\card{X_Q}+1$ containing all vertices of $Q$. This yields a contradiction as $Q$ is supposed to be maximal.

Conversely, let $Q$ be a hypercube and assume that its signature $X_Q$ is a maximal POF. We suppose that there is a second hypercube $Q' \neq Q$ such that $X_Q = X_{Q'}$. Then, the set $\bigcap_{X_Q} \partial H_i''$ contains at least two elements: the anti-bases of hypercubes $Q$ and $Q'$. Using the same argument as above, we can put in evidence an edge with two endpoints in $\bigcap_{X_Q} \partial H_i''$. The $\Theta$-class of this edge is thus orthogonal of any class $E_i$ of $X_Q$ which defines an isomorphism between $\partial H_i'$ and $\partial H_i''$. Consequently, we obtain a POF superset of $X_Q$, a contradiction.

For any POF $X$, there is at least one hypercube with signature $X$ such that its anti-basis $v$ verifies $\mathcal{E}^-(v) = X$ according to Lemma~\ref{le:pof_hypercube}. In summary, any maximal POF $X$ can be associated with an unique hypercube of signature $X$.
\end{proof}

Figure~\ref{subfig:maximal_pof} illustrates this proof with two squares $Q$ and $Q'$ with the same signature $\set{E_i,E_h}$. One can observe the appearance of a hypercube of larger dimension containing $Q$, giving evidence of the non-maximality of $X_Q$.

The number of maximal hypercubes in a median graph is thus equal to the number of maximal POFs, which is itself at most linear in the number of vertices.

\section{Proofs of Section~\ref{subsec:reduction}} \label{asec:subquadratic}

\begin{lemma}\label{lem:guigui-1}
Let $G$ be a median graph.
For every $1 \leq i \leq q$, let $v \in V(H_i')$ be arbitrary, and let $v^*$ be its gate in $\partial H_i''$.
Then, $\ecc(v) = \max\{\ecc_{H_i'}(v), d(v,v^*) + \ecc_{H_i''}(v^*)\}$.
\end{lemma}
\begin{proof}
We have $\ecc(v) = \ecc_G(v) = \max\{d(u,v) \mid u \in V(H_i')\} \cup \{d(w,v) \mid w \in V(H_i'')\}$.
Since $H_i'$ is convex, we have $\max\{d(u,v) \mid u \in V(H_i')\} = \ecc_{H_i'}(v)$.
In the same way, since $H_i''$ is gated (and so, convex), we have $\max\{d(w,v) \mid w \in V(H_i'')\} = d(v,v^*) + \max\{d(v^*,w) \mid w \in V(H_i'')\} = d(v,v^*) + \ecc_{H_i''}(v^*)$.
\end{proof}

\begin{lemma}\label{lem:guigui-2}
Let $H$ and $G$ be median graphs.
If $H$ is an induced subgraph of $G$ then, every $\Theta$-class of $H$ is contained in a $\Theta$-class of $G$.
\end{lemma}
\begin{proof}
Every square of $H$ is also a square of $G$.
In particular, two edges of $H$ are in relation $\Theta_0$ if and only if, as edges of $G$, they are also in relation $\Theta_0$.
Since the $\Theta$-classes of $H$ (resp., of $G$) are the transitive closure of its relation $\Theta_0$, it follows that every $\Theta$-class of $H$ is contained in a $\Theta$-class of $G$.
\end{proof}

\begin{lemma}\label{lem:guigui-2bis}
Let $H$ and $G$ be median graphs, and let $E_1,E_2,\ldots,E_q$ denote the $\Theta$-classes of $G$.
If $H$ is an isometric subgraph of $G$ then, the $\Theta$-classes of $H$ are exactly the nonempty subsets among $E_i \cap E(H)$, for $1 \leq i \leq q$.
\end{lemma}
\begin{proof}
It is known~\cite{winkler1984isometric} that two edges $uv,xy$ of $G$ are in the same $\Theta$-class if and only if $d_G(u,x) + d_G(v,y) \neq d_G(u,y) + d_G(v,x)$.
In particular, since $H$ is isometric in $G$, two edges of $H$ are in the same $\Theta$-class of $H$ if and only if they are in the same $\Theta$-class of $G$.
\end{proof}



\end{document}
